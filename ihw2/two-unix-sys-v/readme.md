# Отчёт для программы: 8 баллов. Приложение, взаимодействующее процессами, использующее UNIX SYSTEM V семафоры

## Код программы

Файл программы - [fight-manager.cpp](fight-manager.cpp)

## Описание входных данных

В терминале пользователю предлагается ввести энергию Ций каждого из бойцов, после чего начинается соревнование

## Описание алгоритма работы программы

- Сначала создается семафор с помощью функции `semget`. Семафор используется для синхронизации доступа к разделяемой памяти между процессами.
- Затем создается разделяемая память с помощью функции `shmget`. В этой разделяемой памяти будет храниться количество проведенных боев.
- После проводится само соревнование, где каждый бой моделируется функцией `fight`. В этой функции бойцы соревнуются друг с другом, и победитель определяется на основе их силы. 
- После каждого боя семафор используется для блокировки доступа к разделяемой памяти, чтобы обновить количество проведенных боев.
- Далее аналогично проводится финальный бой, и информация о победителе выводится на экран
  
## Описание кода программы

Сначала инициализируется семафор и разделяемая память. Создается семафор с помощью `semget`, а затем его значение инициализируется с помощью `semctl`. А с помощью функции `ftok` создается ключ для семафора, используя имя, указанное в SEMAPHORE_NAME.
```cpp
key_t sem_key = ftok(SEMAPHORE_NAME, 0);
int semid = semget(sem_key, 1, 0666 | IPC_CREAT);
semctl(semid, 0, SETVAL, 1);

```

В этом блоке кода создается разделяемая память с помощью функции `shmget`, а затем происходит присоединение этой памяти к адресному пространству текущего процесса с помощью `shmat`. Размер разделяемой памяти определяется как `sizeof(int) * array_size`.
```cpp
key_t shm_key = ftok(".", 'a');
int shmid = shmget(shm_key, sizeof(int) * array_size, 0666 | IPC_CREAT);
int* count_array = (int*)shmat(shmid, NULL, 0);
```

В функции `fight` семафор блокируется перед тем, как начать выполнение операций с разделяемой памятью, и разблокируется после их завершения, что обеспечивает синхронизацию между процессами, чтобы предотвратить одновременный доступ к данным о боях и бойцах.
```cpp
struct sembuf mybuf;
mybuf.sem_num = 0;
mybuf.sem_flg = 0;
mybuf.sem_op  = -1;
semop(semid, &mybuf, 1);
// ...
mybuf.sem_op  = 1;
semop(semid, &mybuf, 1);
```

В конце программы разделяемая память отсоединяется от адресного пространства процесса с помощью `shmdt`, затем она удаляется с помощью `shmctl`. Семафор также удаляется с помощью `semctl`.
```cpp
shmdt(count_array);
shmctl(shmid, IPC_RMID, NULL);
semctl(semid, 0, IPC_RMID);
```
